!function(t){"use strict";if("object"==typeof exports)module.exports=t("undefined"!=typeof angular?angular:require("angular"),"undefined"!=typeof Chart?Chart:require("chart.js"));else if("function"==typeof define&&define.amd)define(["angular","chart"],t);else{if("undefined"==typeof angular||"undefined"==typeof Chart)throw new Error("Chart.js library needs to included, see http://jtblin.github.io/angular-chart.js/");t(angular,Chart)}}(function(t,r){"use strict";function a(){var a={responsive:!0},e={Chart:r,getOptions:function(r){var e=r&&a[r]||{};return t.extend({},a,e)}};this.setOptions=function(r,e){return e?void(a[r]=t.extend(a[r]||{},e)):(e=r,void(a=t.extend(a,e)))},this.$get=function(){return e}}function e(a,e){function o(t,r,e){var n=w(t,r);if(p(r)&&$(t,r,e,n)){var o=e[0],c=o.getContext("2d");r.chartGetColor=C(r);var i=y(t,r);F(r),r.chart=new a.Chart(c,{type:t,data:i,options:n}),r.$emit("chart-create",r.chart),D(o,r)}}function c(t,r){return!!(t&&r&&t.length&&r.length)&&(Array.isArray(t[0])?t.length===r.length&&t.every(function(t,a){return t.length===r[a].length}):r.reduce(i,0)>0&&t.length===r.length)}function i(t,r){return t+r}function u(r,a,e){var n=null;return function(o){var c=r.chart.getElementsAtEvent||r.chart.getPointsAtEvent;if(c){var i=c.call(r.chart,o);e!==!1&&t.equals(n,i)!==!1||(n=i,r[a](i,o))}}}function h(e,n){for(var o=t.copy(n.chartColors||a.getOptions(e).chartColors||r.defaults.global.colors),c=o.length<n.chartData.length;o.length<n.chartData.length;)o.push(n.chartGetColor());return c&&(n.chartColors=o),o.map(l)}function l(t){return"object"==typeof t&&null!==t?t:"string"==typeof t&&"#"===t[0]?f(v(t.substr(1))):s()}function s(){var t=[d(0,255),d(0,255),d(0,255)];return f(t)}function f(t){return{backgroundColor:g(t,.2),pointBackgroundColor:g(t,1),pointHoverBackgroundColor:g(t,.8),borderColor:g(t,1),pointBorderColor:"#fff",pointHoverBorderColor:g(t,1)}}function d(t,r){return Math.floor(Math.random()*(r-t+1))+t}function g(t,r){return n?"rgb("+t.join(",")+")":"rgba("+t.concat(r).join(",")+")"}function v(t){var r=parseInt(t,16),a=r>>16&255,e=r>>8&255,n=255&r;return[a,e,n]}function p(t){return t.chartData&&t.chartData.length}function C(t){return"function"==typeof t.chartGetColor?t.chartGetColor:s}function y(t,r){var a=h(t,r);return Array.isArray(r.chartData[0])?b(r.chartLabels,r.chartData,r.chartSeries||[],a,r.chartDatasetOverride):m(r.chartLabels,r.chartData,a,r.chartDatasetOverride)}function b(r,a,e,n,o){return{labels:r,datasets:a.map(function(r,a){var c=t.extend({},n[a],{label:e[a],data:r});return o&&o.length>=a&&t.merge(c,o[a]),c})}}function m(r,a,e,n){var o={labels:r,datasets:[{data:a,backgroundColor:e.map(function(t){return t.pointBackgroundColor}),hoverBackgroundColor:e.map(function(t){return t.backgroundColor})}]};return n&&t.merge(o.datasets[0],n),o}function w(r,e){return t.extend({},a.getOptions(r),e.chartOptions)}function D(r,a){r.onclick=a.chartClick?u(a,"chartClick",!1):t.noop,r.onmousemove=a.chartHover?u(a,"chartHover",!0):t.noop}function B(t,r){Array.isArray(r.chartData[0])?r.chart.data.datasets.forEach(function(r,a){r.data=t[a]}):r.chart.data.datasets[0].data=t,r.chart.update(),r.$emit("chart-update",r.chart)}function A(t){return!t||Array.isArray(t)&&!t.length||"object"==typeof t&&!Object.keys(t).length}function $(t,r,a,n){return!n.responsive||0!==a[0].clientHeight||(e(function(){o(t,r,a)},50,!1),!1)}function F(t){t.chart&&(t.chart.destroy(),t.$emit("chart-destroy",t.chart))}return function(r){return{restrict:"CA",scope:{chartGetColor:"=?",chartType:"=",chartData:"=?",chartLabels:"=?",chartOptions:"=?",chartSeries:"=?",chartColors:"=?",chartClick:"=?",chartHover:"=?",chartDatasetOverride:"=?"},link:function(a,e){function i(t,n){if(!t||!t.length||Array.isArray(t[0])&&!t[0].length)return void F(a);var i=r||a.chartType;if(i)return a.chart&&c(t,n)?B(t,a):void o(i,a,e)}function u(n,c){if(!A(n)&&!t.equals(n,c)){var i=r||a.chartType;i&&o(i,a,e)}}function h(r,n){A(r)||t.equals(r,n)||o(r,a,e)}n&&window.G_vmlCanvasManager.initElement(e[0]),a.$watch("chartData",i,!0),a.$watch("chartSeries",u,!0),a.$watch("chartLabels",u,!0),a.$watch("chartOptions",u,!0),a.$watch("chartColors",u,!0),a.$watch("chartDatasetOverride",u,!0),a.$watch("chartType",h,!1),a.$on("$destroy",function(){F(a)}),a.$on("$resize",function(){a.chart&&a.chart.resize()})}}}}r.defaults.global.multiTooltipTemplate="<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%= value %>",r.defaults.global.tooltips.mode="label",r.defaults.global.elements.line.borderWidth=2,r.defaults.global.elements.rectangle.borderWidth=2,r.defaults.global.legend.display=!1,r.defaults.global.colors=["#97BBCD","#DCDCDC","#F7464A","#46BFBD","#FDB45C","#949FB1","#4D5360"];var n="object"==typeof window.G_vmlCanvasManager&&null!==window.G_vmlCanvasManager&&"function"==typeof window.G_vmlCanvasManager.initElement;return n&&(r.defaults.global.animation=!1),t.module("chart.js",[]).provider("ChartJs",a).factory("ChartJsFactory",["ChartJs","$timeout",e]).directive("chartBase",["ChartJsFactory",function(t){return new t}]).directive("chartLine",["ChartJsFactory",function(t){return new t("line")}]).directive("chartBar",["ChartJsFactory",function(t){return new t("bar")}]).directive("chartHorizontalBar",["ChartJsFactory",function(t){return new t("horizontalBar")}]).directive("chartRadar",["ChartJsFactory",function(t){return new t("radar")}]).directive("chartDoughnut",["ChartJsFactory",function(t){return new t("doughnut")}]).directive("chartPie",["ChartJsFactory",function(t){return new t("pie")}]).directive("chartPolarArea",["ChartJsFactory",function(t){return new t("polarArea")}]).directive("chartBubble",["ChartJsFactory",function(t){return new t("bubble")}]).name});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItY2hhcnQuanMiXSwibmFtZXMiOlsiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJhbmd1bGFyIiwicmVxdWlyZSIsIkNoYXJ0IiwiZGVmaW5lIiwiYW1kIiwiRXJyb3IiLCJDaGFydEpzUHJvdmlkZXIiLCJvcHRpb25zIiwicmVzcG9uc2l2ZSIsIkNoYXJ0SnMiLCJnZXRPcHRpb25zIiwidHlwZSIsInR5cGVPcHRpb25zIiwiZXh0ZW5kIiwidGhpcyIsInNldE9wdGlvbnMiLCJjdXN0b21PcHRpb25zIiwiJGdldCIsIkNoYXJ0SnNGYWN0b3J5IiwiJHRpbWVvdXQiLCJjcmVhdGVDaGFydCIsInNjb3BlIiwiZWxlbSIsImdldENoYXJ0T3B0aW9ucyIsImhhc0RhdGEiLCJjYW5EaXNwbGF5IiwiY3ZzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImNoYXJ0R2V0Q29sb3IiLCJnZXRDaGFydENvbG9yRm4iLCJkYXRhIiwiZ2V0Q2hhcnREYXRhIiwiZGVzdHJveUNoYXJ0IiwiY2hhcnQiLCIkZW1pdCIsImJpbmRFdmVudHMiLCJjYW5VcGRhdGVDaGFydCIsIm5ld1ZhbCIsIm9sZFZhbCIsImxlbmd0aCIsIkFycmF5IiwiaXNBcnJheSIsImV2ZXJ5IiwiZWxlbWVudCIsImluZGV4IiwicmVkdWNlIiwic3VtIiwiY2FycnkiLCJ2YWwiLCJnZXRFdmVudEhhbmRsZXIiLCJhY3Rpb24iLCJ0cmlnZ2VyT25seU9uQ2hhbmdlIiwibGFzdFN0YXRlIiwiZXZ0IiwiYXRFdmVudCIsImdldEVsZW1lbnRzQXRFdmVudCIsImdldFBvaW50c0F0RXZlbnQiLCJhY3RpdmVQb2ludHMiLCJjYWxsIiwiZXF1YWxzIiwiZ2V0Q29sb3JzIiwiY29sb3JzIiwiY29weSIsImNoYXJ0Q29sb3JzIiwiZGVmYXVsdHMiLCJnbG9iYWwiLCJub3RFbm91Z2hDb2xvcnMiLCJjaGFydERhdGEiLCJwdXNoIiwibWFwIiwiY29udmVydENvbG9yIiwiY29sb3IiLCJnZXRDb2xvciIsImhleFRvUmdiIiwic3Vic3RyIiwiZ2V0UmFuZG9tQ29sb3IiLCJnZXRSYW5kb21JbnQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJyZ2JhIiwicG9pbnRCYWNrZ3JvdW5kQ29sb3IiLCJwb2ludEhvdmVyQmFja2dyb3VuZENvbG9yIiwiYm9yZGVyQ29sb3IiLCJwb2ludEJvcmRlckNvbG9yIiwicG9pbnRIb3ZlckJvcmRlckNvbG9yIiwibWluIiwibWF4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYWxwaGEiLCJ1c2VFeGNhbnZhcyIsImpvaW4iLCJjb25jYXQiLCJoZXgiLCJiaWdpbnQiLCJwYXJzZUludCIsInIiLCJnIiwiYiIsImdldERhdGFTZXRzIiwiY2hhcnRMYWJlbHMiLCJjaGFydFNlcmllcyIsImNoYXJ0RGF0YXNldE92ZXJyaWRlIiwiZ2V0RGF0YSIsImxhYmVscyIsInNlcmllcyIsImRhdGFzZXRPdmVycmlkZSIsImRhdGFzZXRzIiwiaXRlbSIsImkiLCJkYXRhc2V0IiwibGFiZWwiLCJtZXJnZSIsImhvdmVyQmFja2dyb3VuZENvbG9yIiwiY2hhcnRPcHRpb25zIiwib25jbGljayIsImNoYXJ0Q2xpY2siLCJub29wIiwib25tb3VzZW1vdmUiLCJjaGFydEhvdmVyIiwidXBkYXRlQ2hhcnQiLCJ2YWx1ZXMiLCJmb3JFYWNoIiwidXBkYXRlIiwiaXNFbXB0eSIsInZhbHVlIiwiT2JqZWN0Iiwia2V5cyIsImNsaWVudEhlaWdodCIsImRlc3Ryb3kiLCJyZXN0cmljdCIsImNoYXJ0VHlwZSIsImxpbmsiLCJ3YXRjaERhdGEiLCJ3YXRjaE90aGVyIiwid2F0Y2hUeXBlIiwid2luZG93IiwiR192bWxDYW52YXNNYW5hZ2VyIiwiaW5pdEVsZW1lbnQiLCIkd2F0Y2giLCIkb24iLCJyZXNpemUiLCJtdWx0aVRvb2x0aXBUZW1wbGF0ZSIsInRvb2x0aXBzIiwibW9kZSIsImVsZW1lbnRzIiwibGluZSIsImJvcmRlcldpZHRoIiwicmVjdGFuZ2xlIiwibGVnZW5kIiwiZGlzcGxheSIsImFuaW1hdGlvbiIs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QUNBLFVBQ0EsVUFDQSxVQUNBLFVBQ0EsVUFHRixJQUFJNkIsR0FBbUQsZ0JBQTlCOEMsUUFBT0Msb0JBQ0EsT0FBOUJELE9BQU9DLG9CQUMwQyxrQkFBMUNELFFBQU9DLG1CQUFtQkMsV0FJbkMsT0FGSWhELEtBQWF6RixFQUFNK0QsU0FBU0MsT0FBT3NGLFdBQVksR0FFNUN4SixFQUFRRCxPQUFPLGVBQ25CMEosU0FBUyxVQUFXbkosR0FDcEJULFFBQVEsa0JBQW1CLFVBQVcsV0FBWXFCLElBQ2xEd0ksVUFBVSxhQUFjLGlCQUFrQixTQUFVeEksR0FBa0IsTUFBTyxJQUFJQSxNQUNqRndJLFVBQVUsYUFBYyxpQkFBa0IsU0FBVXhJLEdBQWtCLE1BQU8sSUFBSUEsR0FBZSxXQUNoR3dJLFVBQVUsWUFBYSxpQkFBa0IsU0FBVXhJLEdBQWtCLE1BQU8sSUFBSUEsR0FBZSxVQUMvRndJLFVBQVUsc0JBQXVCLGlCQUFrQixTQUFVeEksR0FBa0IsTUFBTyxJQUFJQSxHQUFlLG9CQUN6R3dJLFVBQVUsY0FBZSxpQkFBa0IsU0FBVXhJLEdBQWtCLE1BQU8sSUFBSUEsR0FBZSxZQUNqR3dJLFVBQVUsaUJBQWtCLGlCQUFrQixTQUFVeEksR0FBa0IsTUFBTyxJQUFJQSxHQUFlLGVBQ3BHd0ksVUFBVSxZQUFhLGlCQUFrQixTQUFVeEksR0FBa0IsTUFBTyxJQUFJQSxHQUFlLFVBQy9Gd0ksVUFBVSxrQkFBbUIsaUJBQWtCLFNBQVV4SSxHQUFrQixNQUFPLElBQUlBLEdBQWUsZ0JBQ3JHd0ksVUFBVSxlQUFnQixpQkFBa0IsU0FBVXhJLEdBQWtCLE1BQU8sSUFBSUEsR0FBZSxhQUNsR3lJIiwiZmlsZSI6ImFuZ3VsYXItY2hhcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIGFuZ3VsYXItY2hhcnQuanMgLSBBbiBhbmd1bGFyLmpzIHdyYXBwZXIgZm9yIENoYXJ0LmpzXG4gKiBodHRwOi8vanRibGluLmdpdGh1Yi5pby9hbmd1bGFyLWNoYXJ0LmpzL1xuICogVmVyc2lvbjogMS4wLjBcbiAqXG4gKiBDb3B5cmlnaHQgMjAxNiBKZXJvbWUgVG91ZmZlLUJsaW5cbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBCU0QtMi1DbGF1c2UgbGljZW5zZVxuICogaHR0cHM6Ly9naXRodWIuY29tL2p0Ymxpbi9hbmd1bGFyLWNoYXJ0LmpzL2Jsb2IvbWFzdGVyL0xJQ0VOU0VcbiAqL1xuKGZ1bmN0aW9uIChmYWN0b3J5KSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIC8vIE5vZGUvQ29tbW9uSlNcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoXG4gICAgICB0eXBlb2YgYW5ndWxhciAhPT0gJ3VuZGVmaW5lZCcgPyBhbmd1bGFyIDogcmVxdWlyZSgnYW5ndWxhcicpLFxuICAgICAgdHlwZW9mIENoYXJ0ICE9PSAndW5kZWZpbmVkJyA/IENoYXJ0IDogcmVxdWlyZSgnY2hhcnQuanMnKSk7XG4gIH0gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cbiAgICBkZWZpbmUoWydhbmd1bGFyJywgJ2NoYXJ0J10sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIC8vIEJyb3dzZXIgZ2xvYmFsc1xuICAgIGlmICh0eXBlb2YgYW5ndWxhciA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIENoYXJ0ID09PSAndW5kZWZpbmVkJylcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2hhcnQuanMgbGlicmFyeSBuZWVkcyB0byBpbmNsdWRlZCwgc2VlIGh0dHA6Ly9qdGJsaW4uZ2l0aHViLmlvL2FuZ3VsYXItY2hhcnQuanMvJyk7XG4gICAgZmFjdG9yeShhbmd1bGFyLCBDaGFydCk7XG4gIH1cbn0oZnVuY3Rpb24gKGFuZ3VsYXIsIENoYXJ0KSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBDaGFydC5kZWZhdWx0cy5nbG9iYWwubXVsdGlUb29sdGlwVGVtcGxhdGUgPSAnPCVpZiAoZGF0YXNldExhYmVsKXslPjwlPWRhdGFzZXRMYWJlbCU+OiA8JX0lPjwlPSB2YWx1ZSAlPic7XG4gIENoYXJ0LmRlZmF1bHRzLmdsb2JhbC50b29sdGlwcy5tb2RlID0gJ2xhYmVsJztcbiAgQ2hhcnQuZGVmYXVsdHMuZ2xvYmFsLmVsZW1lbnRzLmxpbmUuYm9yZGVyV2lkdGggPSAyO1xuICBDaGFydC5kZWZhdWx0cy5nbG9iYWwuZWxlbWVudHMucmVjdGFuZ2xlLmJvcmRlcldpZHRoID0gMjtcbiAgQ2hhcnQuZGVmYXVsdHMuZ2xvYmFsLmxlZ2VuZC5kaXNwbGF5ID0gZmFsc2U7XG4gIENoYXJ0LmRlZmF1bHRzLmdsb2JhbC5jb2xvcnMgPSBbXG4gICAgJyM5N0JCQ0QnLCAvLyBibHVlXG4gICAgJyNEQ0RDREMnLCAvLyBsaWdodCBncmV5XG4gICAgJyNGNzQ2NEEnLCAvLyByZWRcbiAgICAnIzQ2QkZCRCcsIC8vIGdyZWVuXG4gICAgJyNGREI0NUMnLCAvLyB5ZWxsb3dcbiAgICAnIzk0OUZCMScsIC8vIGdyZXlcbiAgICAnIzRENTM2MCcgIC8vIGRhcmsgZ3JleVxuICBdO1xuXG4gIHZhciB1c2VFeGNhbnZhcyA9IHR5cGVvZiB3aW5kb3cuR192bWxDYW52YXNNYW5hZ2VyID09PSAnb2JqZWN0JyAmJlxuICAgIHdpbmRvdy5HX3ZtbENhbnZhc01hbmFnZXIgIT09IG51bGwgJiZcbiAgICB0eXBlb2Ygd2luZG93Lkdfdm1sQ2FudmFzTWFuYWdlci5pbml0RWxlbWVudCA9PT0gJ2Z1bmN0aW9uJztcblxuICBpZiAodXNlRXhjYW52YXMpIENoYXJ0LmRlZmF1bHRzLmdsb2JhbC5hbmltYXRpb24gPSBmYWxzZTtcblxuICByZXR1cm4gYW5ndWxhci5tb2R1bGUoJ2NoYXJ0LmpzJywgW10pXG4gICAgLnByb3ZpZGVyKCdDaGFydEpzJywgQ2hhcnRKc1Byb3ZpZGVyKVxuICAgIC5mYWN0b3J5KCdDaGFydEpzRmFjdG9yeScsIFsnQ2hhcnRKcycsICckdGltZW91dCcsIENoYXJ0SnNGYWN0b3J5XSlcbiAgICAuZGlyZWN0aXZlKCdjaGFydEJhc2UnLCBbJ0NoYXJ0SnNGYWN0b3J5JywgZnVuY3Rpb24gKENoYXJ0SnNGYWN0b3J5KSB7IHJldHVybiBuZXcgQ2hhcnRKc0ZhY3RvcnkoKTsgfV0pXG4gICAgLmRpcmVjdGl2ZSgnY2hhcnRMaW5lJywgWydDaGFydEpzRmFjdG9yeScsIGZ1bmN0aW9uIChDaGFydEpzRmFjdG9yeSkgeyByZXR1cm4gbmV3IENoYXJ0SnNGYWN0b3J5KCdsaW5lJyk7IH1dKVxuICAgIC5kaXJlY3RpdmUoJ2NoYXJ0QmFyJywgWydDaGFydEpzRmFjdG9yeScsIGZ1bmN0aW9uIChDaGFydEpzRmFjdG9yeSkgeyByZXR1cm4gbmV3IENoYXJ0SnNGYWN0b3J5KCdiYXInKTsgfV0pXG4gICAgLmRpcmVjdGl2ZSgnY2hhcnRIb3Jpem9udGFsQmFyJywgWydDaGFydEpzRmFjdG9yeScsIGZ1bmN0aW9uIChDaGFydEpzRmFjdG9yeSkgeyByZXR1cm4gbmV3IENoYXJ0SnNGYWN0b3J5KCdob3Jpem9udGFsQmFyJyk7IH1dKVxuICAgIC5kaXJlY3RpdmUoJ2NoYXJ0UmFkYXInLCBbJ0NoYXJ0SnNGYWN0b3J5JywgZnVuY3Rpb24gKENoYXJ0SnNGYWN0b3J5KSB7IHJldHVybiBuZXcgQ2hhcnRKc0ZhY3RvcnkoJ3JhZGFyJyk7IH1dKVxuICAgIC5kaXJlY3RpdmUoJ2NoYXJ0RG91Z2hudXQnLCBbJ0NoYXJ0SnNGYWN0b3J5JywgZnVuY3Rpb24gKENoYXJ0SnNGYWN0b3J5KSB7IHJldHVybiBuZXcgQ2hhcnRKc0ZhY3RvcnkoJ2RvdWdobnV0Jyk7IH1dKVxuICAgIC5kaXJlY3RpdmUoJ2NoYXJ0UGllJywgWydDaGFydEpzRmFjdG9yeScsIGZ1bmN0aW9uIChDaGFydEpzRmFjdG9yeSkgeyByZXR1cm4gbmV3IENoYXJ0SnNGYWN0b3J5KCdwaWUnKTsgfV0pXG4gICAgLmRpcmVjdGl2ZSgnY2hhcnRQb2xhckFyZWEnLCBbJ0NoYXJ0SnNGYWN0b3J5JywgZnVuY3Rpb24gKENoYXJ0SnNGYWN0b3J5KSB7IHJldHVybiBuZXcgQ2hhcnRKc0ZhY3RvcnkoJ3BvbGFyQXJlYScpOyB9XSlcbiAgICAuZGlyZWN0aXZlKCdjaGFydEJ1YmJsZScsIFsnQ2hhcnRKc0ZhY3RvcnknLCBmdW5jdGlvbiAoQ2hhcnRKc0ZhY3RvcnkpIHsgcmV0dXJuIG5ldyBDaGFydEpzRmFjdG9yeSgnYnViYmxlJyk7IH1dKVxuICAgIC5uYW1lO1xuXG4gIC8qKlxuICAgKiBXcmFwcGVyIGZvciBjaGFydC5qc1xuICAgKiBBbGxvd3MgY29uZmlndXJpbmcgY2hhcnQganMgdXNpbmcgdGhlIHByb3ZpZGVyXG4gICAqXG4gICAqIGFuZ3VsYXIubW9kdWxlKCdteU1vZHVsZScsIFsnY2hhcnQuanMnXSkuY29uZmlnKGZ1bmN0aW9uKENoYXJ0SnNQcm92aWRlcikge1xuICAgKiAgIENoYXJ0SnNQcm92aWRlci5zZXRPcHRpb25zKHsgcmVzcG9uc2l2ZTogZmFsc2UgfSk7XG4gICAqICAgQ2hhcnRKc1Byb3ZpZGVyLnNldE9wdGlvbnMoJ0xpbmUnLCB7IHJlc3BvbnNpdmU6IHRydWUgfSk7XG4gICAqIH0pKSlcbiAgICovXG4gIGZ1bmN0aW9uIENoYXJ0SnNQcm92aWRlciAoKSB7XG4gICAgdmFyIG9wdGlvbnMgPSB7IHJlc3BvbnNpdmU6IHRydWUgfTtcbiAgICB2YXIgQ2hhcnRKcyA9IHtcbiAgICAgIENoYXJ0OiBDaGFydCxcbiAgICAgIGdldE9wdGlvbnM6IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIHZhciB0eXBlT3B0aW9ucyA9IHR5cGUgJiYgb3B0aW9uc1t0eXBlXSB8fCB7fTtcbiAgICAgICAgcmV0dXJuIGFuZ3VsYXIuZXh0ZW5kKHt9LCBvcHRpb25zLCB0eXBlT3B0aW9ucyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEFsbG93IHRvIHNldCBnbG9iYWwgb3B0aW9ucyBkdXJpbmcgY29uZmlndXJhdGlvblxuICAgICAqL1xuICAgIHRoaXMuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uICh0eXBlLCBjdXN0b21PcHRpb25zKSB7XG4gICAgICAvLyBJZiBubyB0eXBlIHdhcyBzcGVjaWZpZWQgc2V0IG9wdGlvbiBmb3IgdGhlIGdsb2JhbCBvYmplY3RcbiAgICAgIGlmICghIGN1c3RvbU9wdGlvbnMpIHtcbiAgICAgICAgY3VzdG9tT3B0aW9ucyA9IHR5cGU7XG4gICAgICAgIG9wdGlvbnMgPSBhbmd1bGFyLmV4dGVuZChvcHRpb25zLCBjdXN0b21PcHRpb25zKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gU2V0IG9wdGlvbnMgZm9yIHRoZSBzcGVjaWZpYyBjaGFydFxuICAgICAgb3B0aW9uc1t0eXBlXSA9IGFuZ3VsYXIuZXh0ZW5kKG9wdGlvbnNbdHlwZV0gfHwge30sIGN1c3RvbU9wdGlvbnMpO1xuICAgIH07XG5cbiAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gQ2hhcnRKcztcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gQ2hhcnRKc0ZhY3RvcnkgKENoYXJ0SnMsICR0aW1lb3V0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIGNoYXJ0ICh0eXBlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0NBJyxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICBjaGFydEdldENvbG9yOiAnPT8nLFxuICAgICAgICAgIGNoYXJ0VHlwZTogJz0nLFxuICAgICAgICAgIGNoYXJ0RGF0YTogJz0/JyxcbiAgICAgICAgICBjaGFydExhYmVsczogJz0/JyxcbiAgICAgICAgICBjaGFydE9wdGlvbnM6ICc9PycsXG4gICAgICAgICAgY2hhcnRTZXJpZXM6ICc9PycsXG4gICAgICAgICAgY2hhcnRDb2xvcnM6ICc9PycsXG4gICAgICAgICAgY2hhcnRDbGljazogJz0/JyxcbiAgICAgICAgICBjaGFydEhvdmVyOiAnPT8nLFxuICAgICAgICAgIGNoYXJ0RGF0YXNldE92ZXJyaWRlOiAnPT8nXG4gICAgICAgIH0sXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbS8qLCBhdHRycyAqLykge1xuICAgICAgICAgIGlmICh1c2VFeGNhbnZhcykgd2luZG93Lkdfdm1sQ2FudmFzTWFuYWdlci5pbml0RWxlbWVudChlbGVtWzBdKTtcblxuICAgICAgICAgIC8vIE9yZGVyIG9mIHNldHRpbmcgXCJ3YXRjaFwiIG1hdHRlclxuICAgICAgICAgIHNjb3BlLiR3YXRjaCgnY2hhcnREYXRhJywgd2F0Y2hEYXRhLCB0cnVlKTtcbiAgICAgICAgICBzY29wZS4kd2F0Y2goJ2NoYXJ0U2VyaWVzJywgd2F0Y2hPdGhlciwgdHJ1ZSk7XG4gICAgICAgICAgc2NvcGUuJHdhdGNoKCdjaGFydExhYmVscycsIHdhdGNoT3RoZXIsIHRydWUpO1xuICAgICAgICAgIHNjb3BlLiR3YXRjaCgnY2hhcnRPcHRpb25zJywgd2F0Y2hPdGhlciwgdHJ1ZSk7XG4gICAgICAgICAgc2NvcGUuJHdhdGNoKCdjaGFydENvbG9ycycsIHdhdGNoT3RoZXIsIHRydWUpO1xuICAgICAgICAgIHNjb3BlLiR3YXRjaCgnY2hhcnREYXRhc2V0T3ZlcnJpZGUnLCB3YXRjaE90aGVyLCB0cnVlKTtcbiAgICAgICAgICBzY29wZS4kd2F0Y2goJ2NoYXJ0VHlwZScsIHdhdGNoVHlwZSwgZmFsc2UpO1xuXG4gICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRlc3Ryb3lDaGFydChzY29wZSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBzY29wZS4kb24oJyRyZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoc2NvcGUuY2hhcnQpIHNjb3BlLmNoYXJ0LnJlc2l6ZSgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgZnVuY3Rpb24gd2F0Y2hEYXRhIChuZXdWYWwsIG9sZFZhbCkge1xuICAgICAgICAgICAgaWYgKCEgbmV3VmFsIHx8ICEgbmV3VmFsLmxlbmd0aCB8fCAoQXJyYXkuaXNBcnJheShuZXdWYWxbMF0pICYmICEgbmV3VmFsWzBdLmxlbmd0aCkpIHtcbiAgICAgICAgICAgICAgZGVzdHJveUNoYXJ0KHNjb3BlKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNoYXJ0VHlwZSA9IHR5cGUgfHwgc2NvcGUuY2hhcnRUeXBlO1xuICAgICAgICAgICAgaWYgKCEgY2hhcnRUeXBlKSByZXR1cm47XG5cbiAgICAgICAgICAgIGlmIChzY29wZS5jaGFydCAmJiBjYW5VcGRhdGVDaGFydChuZXdWYWwsIG9sZFZhbCkpXG4gICAgICAgICAgICAgIHJldHVybiB1cGRhdGVDaGFydChuZXdWYWwsIHNjb3BlKTtcblxuICAgICAgICAgICAgY3JlYXRlQ2hhcnQoY2hhcnRUeXBlLCBzY29wZSwgZWxlbSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZnVuY3Rpb24gd2F0Y2hPdGhlciAobmV3VmFsLCBvbGRWYWwpIHtcbiAgICAgICAgICAgIGlmIChpc0VtcHR5KG5ld1ZhbCkpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWwsIG9sZFZhbCkpIHJldHVybjtcbiAgICAgICAgICAgIHZhciBjaGFydFR5cGUgPSB0eXBlIHx8IHNjb3BlLmNoYXJ0VHlwZTtcbiAgICAgICAgICAgIGlmICghIGNoYXJ0VHlwZSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAvLyBjaGFydC51cGRhdGUoKSBkb2Vzbid0IHdvcmsgZm9yIHNlcmllcyBhbmQgbGFiZWxzXG4gICAgICAgICAgICAvLyBzbyB3ZSBoYXZlIHRvIHJlLWNyZWF0ZSB0aGUgY2hhcnQgZW50aXJlbHlcbiAgICAgICAgICAgIGNyZWF0ZUNoYXJ0KGNoYXJ0VHlwZSwgc2NvcGUsIGVsZW0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZ1bmN0aW9uIHdhdGNoVHlwZSAobmV3VmFsLCBvbGRWYWwpIHtcbiAgICAgICAgICAgIGlmIChpc0VtcHR5KG5ld1ZhbCkpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWwsIG9sZFZhbCkpIHJldHVybjtcbiAgICAgICAgICAgIGNyZWF0ZUNoYXJ0KG5ld1ZhbCwgc2NvcGUsIGVsZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlQ2hhcnQgKHR5cGUsIHNjb3BlLCBlbGVtKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IGdldENoYXJ0T3B0aW9ucyh0eXBlLCBzY29wZSk7XG4gICAgICBpZiAoISBoYXNEYXRhKHNjb3BlKSB8fCAhIGNhbkRpc3BsYXkodHlwZSwgc2NvcGUsIGVsZW0sIG9wdGlvbnMpKSByZXR1cm47XG5cbiAgICAgIHZhciBjdnMgPSBlbGVtWzBdO1xuICAgICAgdmFyIGN0eCA9IGN2cy5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgICBzY29wZS5jaGFydEdldENvbG9yID0gZ2V0Q2hhcnRDb2xvckZuKHNjb3BlKTtcbiAgICAgIHZhciBkYXRhID0gZ2V0Q2hhcnREYXRhKHR5cGUsIHNjb3BlKTtcblxuICAgICAgLy8gRGVzdHJveSBvbGQgY2hhcnQgaWYgaXQgZXhpc3RzIHRvIGF2b2lkIGdob3N0IGNoYXJ0cyBpc3N1ZVxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2p0Ymxpbi9hbmd1bGFyLWNoYXJ0LmpzL2lzc3Vlcy8xODdcbiAgICAgIGRlc3Ryb3lDaGFydChzY29wZSk7XG5cbiAgICAgIHNjb3BlLmNoYXJ0ID0gbmV3IENoYXJ0SnMuQ2hhcnQoY3R4LCB7XG4gICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgIH0pO1xuICAgICAgc2NvcGUuJGVtaXQoJ2NoYXJ0LWNyZWF0ZScsIHNjb3BlLmNoYXJ0KTtcbiAgICAgIGJpbmRFdmVudHMoY3ZzLCBzY29wZSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2FuVXBkYXRlQ2hhcnQgKG5ld1ZhbCwgb2xkVmFsKSB7XG4gICAgICBpZiAobmV3VmFsICYmIG9sZFZhbCAmJiBuZXdWYWwubGVuZ3RoICYmIG9sZFZhbC5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkobmV3VmFsWzBdKSA/XG4gICAgICAgIG5ld1ZhbC5sZW5ndGggPT09IG9sZFZhbC5sZW5ndGggJiYgbmV3VmFsLmV2ZXJ5KGZ1bmN0aW9uIChlbGVtZW50LCBpbmRleCkge1xuICAgICAgICAgIHJldHVybiBlbGVtZW50Lmxlbmd0aCA9PT0gb2xkVmFsW2luZGV4XS5sZW5ndGg7IH0pIDpcbiAgICAgICAgICBvbGRWYWwucmVkdWNlKHN1bSwgMCkgPiAwID8gbmV3VmFsLmxlbmd0aCA9PT0gb2xkVmFsLmxlbmd0aCA6IGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN1bSAoY2FycnksIHZhbCkge1xuICAgICAgcmV0dXJuIGNhcnJ5ICsgdmFsO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEV2ZW50SGFuZGxlciAoc2NvcGUsIGFjdGlvbiwgdHJpZ2dlck9ubHlPbkNoYW5nZSkge1xuICAgICAgdmFyIGxhc3RTdGF0ZSA9IG51bGw7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICB2YXIgYXRFdmVudCA9IHNjb3BlLmNoYXJ0LmdldEVsZW1lbnRzQXRFdmVudCB8fCBzY29wZS5jaGFydC5nZXRQb2ludHNBdEV2ZW50O1xuICAgICAgICBpZiAoYXRFdmVudCkge1xuICAgICAgICAgIHZhciBhY3RpdmVQb2ludHMgPSBhdEV2ZW50LmNhbGwoc2NvcGUuY2hhcnQsIGV2dCk7XG4gICAgICAgICAgaWYgKHRyaWdnZXJPbmx5T25DaGFuZ2UgPT09IGZhbHNlIHx8IGFuZ3VsYXIuZXF1YWxzKGxhc3RTdGF0ZSwgYWN0aXZlUG9pbnRzKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGxhc3RTdGF0ZSA9IGFjdGl2ZVBvaW50cztcbiAgICAgICAgICAgIHNjb3BlW2FjdGlvbl0oYWN0aXZlUG9pbnRzLCBldnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRDb2xvcnMgKHR5cGUsIHNjb3BlKSB7XG4gICAgICB2YXIgY29sb3JzID0gYW5ndWxhci5jb3B5KHNjb3BlLmNoYXJ0Q29sb3JzIHx8XG4gICAgICAgIENoYXJ0SnMuZ2V0T3B0aW9ucyh0eXBlKS5jaGFydENvbG9ycyB8fFxuICAgICAgICBDaGFydC5kZWZhdWx0cy5nbG9iYWwuY29sb3JzXG4gICAgICApO1xuICAgICAgdmFyIG5vdEVub3VnaENvbG9ycyA9IGNvbG9ycy5sZW5ndGggPCBzY29wZS5jaGFydERhdGEubGVuZ3RoO1xuICAgICAgd2hpbGUgKGNvbG9ycy5sZW5ndGggPCBzY29wZS5jaGFydERhdGEubGVuZ3RoKSB7XG4gICAgICAgIGNvbG9ycy5wdXNoKHNjb3BlLmNoYXJ0R2V0Q29sb3IoKSk7XG4gICAgICB9XG4gICAgICAvLyBtdXRhdGUgY29sb3JzIGluIHRoaXMgY2FzZSBhcyB3ZSBkb24ndCB3YW50XG4gICAgICAvLyB0aGUgY29sb3JzIHRvIGNoYW5nZSBvbiBlYWNoIHJlZnJlc2hcbiAgICAgIGlmIChub3RFbm91Z2hDb2xvcnMpIHNjb3BlLmNoYXJ0Q29sb3JzID0gY29sb3JzO1xuICAgICAgcmV0dXJuIGNvbG9ycy5tYXAoY29udmVydENvbG9yKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb252ZXJ0Q29sb3IgKGNvbG9yKSB7XG4gICAgICBpZiAodHlwZW9mIGNvbG9yID09PSAnb2JqZWN0JyAmJiBjb2xvciAhPT0gbnVsbCkgcmV0dXJuIGNvbG9yO1xuICAgICAgaWYgKHR5cGVvZiBjb2xvciA9PT0gJ3N0cmluZycgJiYgY29sb3JbMF0gPT09ICcjJykgcmV0dXJuIGdldENvbG9yKGhleFRvUmdiKGNvbG9yLnN1YnN0cigxKSkpO1xuICAgICAgcmV0dXJuIGdldFJhbmRvbUNvbG9yKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IgKCkge1xuICAgICAgdmFyIGNvbG9yID0gW2dldFJhbmRvbUludCgwLCAyNTUpLCBnZXRSYW5kb21JbnQoMCwgMjU1KSwgZ2V0UmFuZG9tSW50KDAsIDI1NSldO1xuICAgICAgcmV0dXJuIGdldENvbG9yKGNvbG9yKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRDb2xvciAoY29sb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogcmdiYShjb2xvciwgMC4yKSxcbiAgICAgICAgcG9pbnRCYWNrZ3JvdW5kQ29sb3I6IHJnYmEoY29sb3IsIDEpLFxuICAgICAgICBwb2ludEhvdmVyQmFja2dyb3VuZENvbG9yOiByZ2JhKGNvbG9yLCAwLjgpLFxuICAgICAgICBib3JkZXJDb2xvcjogcmdiYShjb2xvciwgMSksXG4gICAgICAgIHBvaW50Qm9yZGVyQ29sb3I6ICcjZmZmJyxcbiAgICAgICAgcG9pbnRIb3ZlckJvcmRlckNvbG9yOiByZ2JhKGNvbG9yLCAxKVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRSYW5kb21JbnQgKG1pbiwgbWF4KSB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZ2JhIChjb2xvciwgYWxwaGEpIHtcbiAgICAgIC8vIHJnYmEgbm90IHN1cHBvcnRlZCBieSBJRThcbiAgICAgIHJldHVybiB1c2VFeGNhbnZhcyA/ICdyZ2IoJyArIGNvbG9yLmpvaW4oJywnKSArICcpJyA6ICdyZ2JhKCcgKyBjb2xvci5jb25jYXQoYWxwaGEpLmpvaW4oJywnKSArICcpJztcbiAgICB9XG5cbiAgICAvLyBDcmVkaXQ6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzExNTA4MTY0LzExOTAyMzVcbiAgICBmdW5jdGlvbiBoZXhUb1JnYiAoaGV4KSB7XG4gICAgICB2YXIgYmlnaW50ID0gcGFyc2VJbnQoaGV4LCAxNiksXG4gICAgICAgIHIgPSAoYmlnaW50ID4+IDE2KSAmIDI1NSxcbiAgICAgICAgZyA9IChiaWdpbnQgPj4gOCkgJiAyNTUsXG4gICAgICAgIGIgPSBiaWdpbnQgJiAyNTU7XG5cbiAgICAgIHJldHVybiBbciwgZywgYl07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGFzRGF0YSAoc2NvcGUpIHtcbiAgICAgIHJldHVybiBzY29wZS5jaGFydERhdGEgJiYgc2NvcGUuY2hhcnREYXRhLmxlbmd0aDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRDaGFydENvbG9yRm4gKHNjb3BlKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIHNjb3BlLmNoYXJ0R2V0Q29sb3IgPT09ICdmdW5jdGlvbicgPyBzY29wZS5jaGFydEdldENvbG9yIDogZ2V0UmFuZG9tQ29sb3I7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0Q2hhcnREYXRhICh0eXBlLCBzY29wZSkge1xuICAgICAgdmFyIGNvbG9ycyA9IGdldENvbG9ycyh0eXBlLCBzY29wZSk7XG4gICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShzY29wZS5jaGFydERhdGFbMF0pID9cbiAgICAgICAgZ2V0RGF0YVNldHMoc2NvcGUuY2hhcnRMYWJlbHMsIHNjb3BlLmNoYXJ0RGF0YSwgc2NvcGUuY2hhcnRTZXJpZXMgfHwgW10sIGNvbG9ycywgc2NvcGUuY2hhcnREYXRhc2V0T3ZlcnJpZGUpIDpcbiAgICAgICAgZ2V0RGF0YShzY29wZS5jaGFydExhYmVscywgc2NvcGUuY2hhcnREYXRhLCBjb2xvcnMsIHNjb3BlLmNoYXJ0RGF0YXNldE92ZXJyaWRlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXREYXRhU2V0cyAobGFiZWxzLCBkYXRhLCBzZXJpZXMsIGNvbG9ycywgZGF0YXNldE92ZXJyaWRlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsYWJlbHM6IGxhYmVscyxcbiAgICAgICAgZGF0YXNldHM6IGRhdGEubWFwKGZ1bmN0aW9uIChpdGVtLCBpKSB7XG4gICAgICAgICAgdmFyIGRhdGFzZXQgPSBhbmd1bGFyLmV4dGVuZCh7fSwgY29sb3JzW2ldLCB7XG4gICAgICAgICAgICBsYWJlbDogc2VyaWVzW2ldLFxuICAgICAgICAgICAgZGF0YTogaXRlbVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmIChkYXRhc2V0T3ZlcnJpZGUgJiYgZGF0YXNldE92ZXJyaWRlLmxlbmd0aCA+PSBpKSB7XG4gICAgICAgICAgICBhbmd1bGFyLm1lcmdlKGRhdGFzZXQsIGRhdGFzZXRPdmVycmlkZVtpXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBkYXRhc2V0O1xuICAgICAgICB9KVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXREYXRhIChsYWJlbHMsIGRhdGEsIGNvbG9ycywgZGF0YXNldE92ZXJyaWRlKSB7XG4gICAgICB2YXIgZGF0YXNldCA9IHtcbiAgICAgICAgbGFiZWxzOiBsYWJlbHMsXG4gICAgICAgIGRhdGFzZXRzOiBbe1xuICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBjb2xvcnMubWFwKGZ1bmN0aW9uIChjb2xvcikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbG9yLnBvaW50QmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGhvdmVyQmFja2dyb3VuZENvbG9yOiBjb2xvcnMubWFwKGZ1bmN0aW9uIChjb2xvcikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbG9yLmJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgICB9KVxuICAgICAgICB9XVxuICAgICAgfTtcbiAgICAgIGlmIChkYXRhc2V0T3ZlcnJpZGUpIHtcbiAgICAgICAgYW5ndWxhci5tZXJnZShkYXRhc2V0LmRhdGFzZXRzWzBdLCBkYXRhc2V0T3ZlcnJpZGUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRhdGFzZXQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0Q2hhcnRPcHRpb25zICh0eXBlLCBzY29wZSkge1xuICAgICAgcmV0dXJuIGFuZ3VsYXIuZXh0ZW5kKHt9LCBDaGFydEpzLmdldE9wdGlvbnModHlwZSksIHNjb3BlLmNoYXJ0T3B0aW9ucyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYmluZEV2ZW50cyAoY3ZzLCBzY29wZSkge1xuICAgICAgY3ZzLm9uY2xpY2sgPSBzY29wZS5jaGFydENsaWNrID8gZ2V0RXZlbnRIYW5kbGVyKHNjb3BlLCAnY2hhcnRDbGljaycsIGZhbHNlKSA6IGFuZ3VsYXIubm9vcDtcbiAgICAgIGN2cy5vbm1vdXNlbW92ZSA9IHNjb3BlLmNoYXJ0SG92ZXIgPyBnZXRFdmVudEhhbmRsZXIoc2NvcGUsICdjaGFydEhvdmVyJywgdHJ1ZSkgOiBhbmd1bGFyLm5vb3A7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXBkYXRlQ2hhcnQgKHZhbHVlcywgc2NvcGUpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHNjb3BlLmNoYXJ0RGF0YVswXSkpIHtcbiAgICAgICAgc2NvcGUuY2hhcnQuZGF0YS5kYXRhc2V0cy5mb3JFYWNoKGZ1bmN0aW9uIChkYXRhc2V0LCBpKSB7XG4gICAgICAgICAgZGF0YXNldC5kYXRhID0gdmFsdWVzW2ldO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNjb3BlLmNoYXJ0LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9IHZhbHVlcztcbiAgICAgIH1cblxuICAgICAgc2NvcGUuY2hhcnQudXBkYXRlKCk7XG4gICAgICBzY29wZS4kZW1pdCgnY2hhcnQtdXBkYXRlJywgc2NvcGUuY2hhcnQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzRW1wdHkgKHZhbHVlKSB7XG4gICAgICByZXR1cm4gISB2YWx1ZSB8fFxuICAgICAgICAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgISB2YWx1ZS5sZW5ndGgpIHx8XG4gICAgICAgICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmICEgT2JqZWN0LmtleXModmFsdWUpLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2FuRGlzcGxheSAodHlwZSwgc2NvcGUsIGVsZW0sIG9wdGlvbnMpIHtcbiAgICAgIC8vIFRPRE86IGNoZWNrIHBhcmVudD9cbiAgICAgIGlmIChvcHRpb25zLnJlc3BvbnNpdmUgJiYgZWxlbVswXS5jbGllbnRIZWlnaHQgPT09IDApIHtcbiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNyZWF0ZUNoYXJ0KHR5cGUsIHNjb3BlLCBlbGVtKTtcbiAgICAgICAgfSwgNTAsIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGVzdHJveUNoYXJ0KHNjb3BlKSB7XG4gICAgICBpZighIHNjb3BlLmNoYXJ0KSByZXR1cm47XG4gICAgICBzY29wZS5jaGFydC5kZXN0cm95KCk7XG4gICAgICBzY29wZS4kZW1pdCgnY2hhcnQtZGVzdHJveScsIHNjb3BlLmNoYXJ0KTtcbiAgICB9XG4gIH1cbn0pKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
