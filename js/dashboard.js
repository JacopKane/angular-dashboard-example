!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={exports:{}};t(n.exports),e.dashboard=n.exports}}(this,function(e){!function(t,n){if("function"==typeof define&&define.amd)define([],n);else if("undefined"!=typeof e)n();else{var r={exports:{}};n(),t.dashboard=r.exports}}(this,function(){"use strict";angular.module("dashboard",["chart.js"]).controller("SliderController",["$scope","$element","$injector",function(e,t,n){t=angular.element(t)[0];var r=this,a=n.get("$log"),o=n.get("$timeout"),u=n.get("$document"),i=angular.element(u.find("body")),s=angular.element(t.querySelector(".bar"))[0],c=angular.element(t.querySelector(".dragger"))[0],m=0,d=s.getBoundingClientRect().width,f=function(){e.amount=Math.round(r.currentX/d*(e.max-e.min)+e.min),o(function(){return e.$digest()})},g=function(){var e=c.getBoundingClientRect().width,t=c.offsetLeft;return t+=e/2};e.amount=Math.round((e.max-e.min)/2),o(function(){f()}),Object.assign(r,{dragging:!1,currentX:g(),mouseDown:function(e){e.preventDefault(),a.debug("mouseDown",e),r.dragging=!0}}),i.on("mousemove",function(e){if(r.dragging===!0){e.preventDefault();var t=g(e)+e.movementX;t<=d&&t>=m&&(a.debug("dragging",t),r.currentX=t,f())}}),i.on("mouseup",function(e){r.dragging===!0&&(e.preventDefault(),a.debug("mouseUp"),r.dragging=!1)})}]).directive("slider",function(){return{scope:{measure:"@measure",amount:"=amount",title:"@title",min:"=min",max:"=max"},restrict:"E",replace:!0,templateUrl:"./template/slider.html",controllerAs:"vm",controller:"SliderController"}}).factory("WeatherApiFactory",["$injector",function(e){var t=e.get("$log"),n=e.get("$http"),r={get:function(){return new Promise(function(e,r){return t.debug("requesting data from weather api"),n({method:"GET",url:"//private-4945e-weather34.apiary-proxy.com/weather34/rain"}).then(function(t){return t.status?200!==t.status?r(t):e(t):r(t)},r)})}};return r}]).controller("DashboardController",["$scope","$injector",function(e,t){var n=this,r=t.get("$log"),a=t.get("$timeout"),o=t.get("WeatherApiFactory"),u=function(e,t,n){r.debug("chanceOfRain started",{pressure:e,temperature:t,amount:n});var a=Math.log(n+1)*Math.log(e-929)*Math.log(t-9),o=Math.min(Math.max(a,0),100),u=Math.min(1.5*o,100),i=Math.max(.5*o,0);return[i,o,u]},i=function(){return 0===n.days.length?n.chanceOfRain:0===n.pressureAmount?n.chanceOfRain:0===n.temperatureAmount?n.chanceOfRain:(n.days.map(function(e,t){u(n.pressureAmount,n.temperatureAmount,e).map(function(e,r){n.chanceOfRain[r]=n.chanceOfRain[r]||[],n.chanceOfRain[r][t]=e})}),r.debug("chanceOfRain",n.chanceOfRain),a(function(){return e.$digest()}),n.chanceOfRain)},s=function(e){n.days=e.data[0].days.map(function(e){return n.labels.push(e.day),e.amount}),i(),r.debug("days",n.days)},c=function(e){r.error(e),n.error=n.str.apiError};Object.assign(e,{pressureAmount:0,temperatureAmount:0}),Object.assign(n,{str:{title:"Weather Dasboard",apiError:"Could not fetch the weather data",sliderPressure:"Pressure",sliderTemperature:"Temperature"},error:"",labels:[],days:[],chanceOfRain:[],onPressureChange:function(e){r.debug("onPressureChange",e),n.pressureAmount=e,i()},onTemperatureChange:function(e){r.debug("onTemperatureChange",e),n.temperatureAmount=e,i()},initialize:function(){e.$watch(n.days,function(e){return i()}),e.$watch("temperatureAmount",n.onTemperatureChange),e.$watch("pressureAmount",n.onPressureChange),o.get().then(s)["catch"](c)}})}])})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhc2hib2FyZC5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZCIsImRhc2hib2FyZCIsInRoaXMiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRlbGVtZW50IiwiJGluamVjdG9yIiwiZWxlbWVudCIsInZtIiwiJGxvZyIsImdldCIsIiR0aW1lb3V0IiwiJGRvY3VtZW50IiwiJGJvZHkiLCJmaW5kIiwiJGJhciIsInF1ZXJ5U2VsZWN0b3IiLCIkZHJhZ2dlciIsIm1pblgiLCJtYXhYIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0Iiwid2lkdGgiLCJjYWxjdWxhdGVBbW91bnQiLCJhbW91bnQiLCJNYXRoIiwicm91bmQiLCJjdXJyZW50WCIsIm1heCIsIm1pbiIsIiRkaWdlc3QiLCJjYWxjdWxhdGVYIiwibGVmdCIsIm9mZnNldExlZnQiLCJPYmplY3QiLCJhc3NpZ24iLCJkcmFnZ2luZyIsIm1vdXNlRG93biIsIiRldmVudCIsInByZXZlbnREZWZhdWx0IiwiZGVidWciLCJvbiIsIm1vdmVtZW50WCIsImRpcmVjdGl2ZSIsInNjb3BlIiwibWVhc3VyZSIsInRpdGxlIiwicmVzdHJpY3QiLCJyZXBsYWNlIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyQXMiLCIkaHR0cCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwibWV0aG9kIiwidXJsIiwidGhlbiIsInJlc3BvbnNlIiwic3RhdHVzIiwid2VhdGhlckFwaSIsImNoYW5jZU9mUmFpbiIsInByZXNzdXJlIiwidGVtcGVyYXR1cmUiLCJzY29yZSIsImxvZyIsIm1lYW4iLCJ1cHBlckJvdW5kIiwibG93ZXJCb3VuZCIsInNldENoYW5jZU9mUmFpbiIsImRheXMiLCJsZW5ndGgiLCJwcmVzc3VyZUFtb3VudCIsInRlbXBlcmF0dXJlQW1vdW50IiwibWFwIiwiZGF5Tm8iLCJjaGFuY2UiLCJjaGFuY2VObyIsInVwZGF0ZVdlYXRoZXIiLCJkYXRhIiwiZGFpbHlJbmZvIiwibGFiZWxzIiwicHVzaCIsImRheSIsImZhaWxlZFRvVXBkYXRlV2VhdGhlciIsImVycm9yIiwic3RyIiwiYXBpRXJyb3IiLCJzbGlkZXJQcmVzc3VyZSIsInNsaWRlclRlbXBlcmF0dXJlIiwib25QcmVzc3VyZUNoYW5nZSIsInByZXNzdXJlVmFsdWUiLCJvblRlbXBlcmF0dXJlQ2hhbmdlIiwidGVtcGVyYXR1cmVWYWx1ZSIsImluaXRpYWxpemUiLCIkd2F0Y2giLCJuZXdWYWwiXSwibWFwcGluZ3MiOiJDQUFBLFNBQVdBLEVBQVFDLEdBQ2pCLEdBQXNCLGtCQUFYQyxTQUF5QkEsT0FBT0MsSUFDekNELFFBQVEsV0FBWUQsT0FDZixJQUF1QixtQkFBWkcsU0FDaEJILEVBQVFHLGFBQ0gsQ0FDTCxHQUFJQyxJQUNGRCxXQUVGSCxHQUFRSSxFQUFJRCxTQUNaSixFQUFPTSxVQUFZRCxFQUFJRCxVQUV4QkcsS0FBTSxTQUFVSCxJQUNqQixTQUFXSixFQUFRQyxHQUNqQixHQUFzQixrQkFBWEMsU0FBeUJBLE9BQU9DLElBQ3pDRCxVQUFXRCxPQUNOLElBQXVCLG1CQUFaRyxHQUNoQkgsUUFDSyxDQUNMLEdBQUlJLElBQ0ZELFdBRUZILEtBQ0FELEVBQU9NLFVBQVlELEVBQUlELFVBRXhCRyxLQUFNLFdBQ1AsWUExQkpDLFNBQVFDLE9BQU8sYUFBYyxhQUMxQkMsV0FBVyxvQkFBQSxTQUFBLFdBQUEsWUFBb0IsU0FBVUMsRUFBUUMsRUFBVUMsR0FFMURELEVBQVdKLFFBQVFNLFFBQVFGLEdBQVUsRUFFckMsSUFDRUcsR0FBS1IsS0FDTFMsRUFBT0gsRUFBVUksSUFBSSxRQUNyQkMsRUFBV0wsRUFBVUksSUFBSSxZQUN6QkUsRUFBWU4sRUFBVUksSUFBSSxhQUMxQkcsRUFBUVosUUFBUU0sUUFBUUssRUFBVUUsS0FBSyxTQUN2Q0MsRUFBT2QsUUFBUU0sUUFBUUYsRUFBU1csY0FBYyxTQUFTLEdBQ3ZEQyxFQUFXaEIsUUFBUU0sUUFBUUYsRUFB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QXFCdEYsRUFBR21GLHFCQUN0Q3ZGLEVBQU8wRixPQUFPLGlCQUFrQnRGLEVBQUdpRixrQkFFbkM5QixFQUNHakQsTUFDQThDLEtBQUtxQixHQUZSbEIsU0FHU3dCIiwiZmlsZSI6ImRhc2hib2FyZC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdkYXNoYm9hcmQnLCBbJ2NoYXJ0LmpzJ10pXG4gIC5jb250cm9sbGVyKCdTbGlkZXJDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsICRpbmplY3Rvcikge1xuXG4gICAgJGVsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoJGVsZW1lbnQpWzBdO1xuXG4gICAgY29uc3RcbiAgICAgIHZtID0gdGhpcyxcbiAgICAgICRsb2cgPSAkaW5qZWN0b3IuZ2V0KCckbG9nJyksXG4gICAgICAkdGltZW91dCA9ICRpbmplY3Rvci5nZXQoJyR0aW1lb3V0JyksXG4gICAgICAkZG9jdW1lbnQgPSAkaW5qZWN0b3IuZ2V0KCckZG9jdW1lbnQnKSxcbiAgICAgICRib2R5ID0gYW5ndWxhci5lbGVtZW50KCRkb2N1bWVudC5maW5kKCdib2R5JykpLFxuICAgICAgJGJhciA9IGFuZ3VsYXIuZWxlbWVudCgkZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuYmFyJykpWzBdLFxuICAgICAgJGRyYWdnZXIgPSBhbmd1bGFyLmVsZW1lbnQoJGVsZW1lbnQucXVlcnlTZWxlY3RvcignLmRyYWdnZXInKSlbMF0sXG4gICAgICBtaW5YID0gMCxcbiAgICAgIG1heFggPSAkYmFyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoLFxuXG4gICAgICAvKipcbiAgICAgICAqIENhbGN1bGF0ZXMgdGhlIHJlYWwgYW1vdW50IGZvciBnaXZlbiBtaW4gYW5kIG1heCB2YWx1ZXMgdG8gZGlyZWN0aXZlXG4gICAgICAgKi9cbiAgICAgIGNhbGN1bGF0ZUFtb3VudCA9ICgpID0+IHtcbiAgICAgICAgJHNjb3BlLmFtb3VudCA9IE1hdGgucm91bmQoKHZtLmN1cnJlbnRYIC8gbWF4WCkgKiAoJHNjb3BlLm1heCAtICRzY29wZS5taW4pICsgJHNjb3BlLm1pbik7XG4gICAgICAgICR0aW1lb3V0KCgpID0+ICRzY29wZS4kZGlnZXN0KCkpXG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIENhbGN1bGF0ZXMgZHJhZ2dlciBwb3NpdGlvbiByZWxhdGl2ZSB0byBsZWZ0XG4gICAgICAgKiBAcmV0dXJucyB7bnVtYmVyfE51bWJlcn1cbiAgICAgICAqL1xuICAgICAgY2FsY3VsYXRlWCA9ICgpID0+IHtcblxuICAgICAgICBsZXRcbiAgICAgICAgICB3aWR0aCA9ICRkcmFnZ2VyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoLFxuICAgICAgICAgIGxlZnQgPSAkZHJhZ2dlci5vZmZzZXRMZWZ0O1xuXG4gICAgICAgIGxlZnQgPSBsZWZ0ICsgKHdpZHRoIC8gMik7XG5cbiAgICAgICAgcmV0dXJuIGxlZnQ7XG4gICAgICB9O1xuXG4gICAgJHNjb3BlLmFtb3VudCA9IE1hdGgucm91bmQoKCRzY29wZS5tYXggLSAkc2NvcGUubWluKSAvIDIpO1xuICAgICR0aW1lb3V0KCgpID0+IHtcbiAgICAgIGNhbGN1bGF0ZUFtb3VudCgpO1xuICAgIH0pO1xuXG4gICAgT2JqZWN0LmFzc2lnbih2bSwge1xuXG4gICAgICBkcmFnZ2luZyA6IGZhbHNlLFxuXG4gICAgICBjdXJyZW50WCA6IGNhbGN1bGF0ZVgoKSxcblxuICAgICAgLyoqXG4gICAgICAgKiBTdGFydHMgdGhlIGRyYWdcbiAgICAgICAqIEBwYXJhbSAkZXZlbnRcbiAgICAgICAqL1xuICAgICAgbW91c2VEb3duIDogKCRldmVudCkgPT4ge1xuICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgJGxvZy5kZWJ1ZygnbW91c2VEb3duJywgJGV2ZW50KTtcbiAgICAgICAgdm0uZHJhZ2dpbmcgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBXYXRjaGVzIHRoZSBtb3VzZSBtb3ZlbWVudCBvbiB0aGUgcGFnZVxuICAgICAqL1xuICAgICRib2R5Lm9uKCdtb3VzZW1vdmUnLCAoJGV2ZW50KSA9PiB7XG4gICAgICBpZiAodm0uZHJhZ2dpbmcgPT09IHRydWUpIHtcbiAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgbGV0IGN1cnJlbnRYID0gY2FsY3VsYXRlWCgkZXZlbnQpICsgJGV2ZW50Lm1vdmVtZW50WDtcblxuICAgICAgICBpZiAoY3VycmVudFggPD0gbWF4WCAmJiBjdXJyZW50WCA+PSBtaW5YKSB7XG4gICAgICAgICAgJGxvZy5kZWJ1ZygnZHJhZ2dpbmcnLCBjdXJyZW50WCk7XG4gICAgICAgICAgdm0uY3VycmVudFggPSBjdXJyZW50WDtcbiAgICAgICAgICBjYWxjdWxhdGVBbW91bnQoKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBFbmRzIHRoZSBkcmFnIG9wZXJhdGlvblxuICAgICAqL1xuICAgICRib2R5Lm9uKCdtb3VzZXVwJywgKCRldmVudCkgPT4ge1xuICAgICAgaWYgKHZtLmRyYWdnaW5nID09PSB0cnVlKSB7XG4gICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkbG9nLmRlYnVnKCdtb3VzZVVwJyk7XG4gICAgICAgIHZtLmRyYWdnaW5nID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSlcbiAgLyoqXG4gICAqIFNsaWRlciBkaXJlY3RpdmVcbiAgICpcbiAgICogWW91IGNhbiB1c2UgaXQgd2l0aCA8c2xpZGVyIC8+IHRhZ1xuICAgKiBSZXF1aXJlcyBhbW91bnQsIG1pbiwgbWF4LCB0aXRsZSBhbmQgbWVhc3VyZVxuICAgKi9cbiAgLmRpcmVjdGl2ZSgnc2xpZGVyJywgKCkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBzY29wZSA6ICAgICAgIHtcbiAgICAgICAgJ21lYXN1cmUnIDogJ0BtZWFzdXJlJyxcbiAgICAgICAgJ2Ftb3VudCcgOiAnPWFtb3VudCcsXG4gICAgICAgICd0aXRsZScgOiAnQHRpdGxlJyxcbiAgICAgICAgJ21pbicgOiAnPW1pbicsXG4gICAgICAgICdtYXgnIDogJz1tYXgnXG4gICAgICB9LFxuICAgICAgcmVzdHJpY3QgOiAgICAnRScsXG4gICAgICByZXBsYWNlIDogICAgIHRydWUsXG4gICAgICB0ZW1wbGF0ZVVybCA6ICcuL3RlbXBsYXRlL3NsaWRlci5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgIGNvbnRyb2xsZXIgOiAnU2xpZGVyQ29udHJvbGxlcidcbiAgICB9O1xuICB9KVxuICAvKipcbiAgICogQSBoZWxwZXIgZmFjdG9yeSBmb3IgZmV0Y2hpbmcgZGF0YSBmcm9tIHdlYXRoZXIgQVBJXG4gICAqL1xuICAuZmFjdG9yeSgnV2VhdGhlckFwaUZhY3RvcnknLCAoJGluamVjdG9yKSA9PiB7XG5cbiAgICBjb25zdFxuXG4gICAgICAkbG9nID0gJGluamVjdG9yLmdldCgnJGxvZycpLFxuXG4gICAgICAkaHR0cCA9ICRpbmplY3Rvci5nZXQoJyRodHRwJyksXG5cbiAgICAgIGZhY3RvcnkgPSB7XG5cbiAgICAgICAgZ2V0IDogKCkgPT4gKG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICRsb2cuZGVidWcoJ3JlcXVlc3RpbmcgZGF0YSBmcm9tIHdlYXRoZXIgYXBpJyk7XG5cbiAgICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kIDogJ0dFVCcsXG4gICAgICAgICAgICB1cmwgOiAnLy9wcml2YXRlLTQ5NDVlLXdlYXRoZXIzNC5hcGlhcnktcHJveHkuY29tL3dlYXRoZXIzNC9yYWluJ1xuICAgICAgICAgIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG5cbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlc3BvbnNlKTtcblxuICAgICAgICAgIH0sIHJlamVjdClcblxuICAgICAgICB9KSlcblxuICAgICAgfTtcblxuICAgIHJldHVybiBmYWN0b3J5O1xuXG4gIH0pXG4gIC8qKlxuICAgKiBEYXNoYm9hcmQgQ29udHJvbGxlclxuICAgKlxuICAgKiBTZXRzIHdpZGdldHMgYW5kIGZldGNoZXMgZGF0YSB3aGVuIGluaXRpYWxpemVkXG4gICAqL1xuICAuY29udHJvbGxlcignRGFzaGJvYXJkQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRpbmplY3Rvcikge1xuXG4gICAgY29uc3RcblxuICAgICAgdm0gPSB0aGlzLFxuXG4gICAgICAkbG9nID0gJGluamVjdG9yLmdldCgnJGxvZycpLFxuXG4gICAgICAkdGltZW91dCA9ICRpbmplY3Rvci5nZXQoJyR0aW1lb3V0JyksXG5cbiAgICAgIHdlYXRoZXJBcGkgPSAkaW5qZWN0b3IuZ2V0KCdXZWF0aGVyQXBpRmFjdG9yeScpLFxuXG4gICAgICAvKipcbiAgICAgICAqIENhbGN1bGF0ZXMgZGFpbHkgY2hhbmNlIG9mIHJhaW5cbiAgICAgICAqIEBwYXJhbSBwcmVzc3VyZVxuICAgICAgICogQHBhcmFtIHRlbXBlcmF0dXJlXG4gICAgICAgKiBAcGFyYW0gYW1vdW50XG4gICAgICAgKiBAcmV0dXJucyB7KltdfVxuICAgICAgICovXG4gICAgICBjaGFuY2VPZlJhaW4gPSAocHJlc3N1cmUsIHRlbXBlcmF0dXJlLCBhbW91bnQpID0+IHtcblxuICAgICAgICAkbG9nLmRlYnVnKCdjaGFuY2VPZlJhaW4gc3RhcnRlZCcsIHtwcmVzc3VyZSwgdGVtcGVyYXR1cmUsIGFtb3VudH0pO1xuXG4gICAgICAgIHZhciBzY29yZSA9IE1hdGgubG9nKGFtb3VudCArIDEpICogTWF0aC5sb2cocHJlc3N1cmUgLSA5MjkpICogTWF0aC5sb2codGVtcGVyYXR1cmUgLSA5KTtcblxuICAgICAgICB2YXIgbWVhbiA9IE1hdGgubWluKE1hdGgubWF4KHNjb3JlLCAwKSwgMTAwKTtcblxuICAgICAgICB2YXIgdXBwZXJCb3VuZCA9IE1hdGgubWluKDEuNSAqIG1lYW4sIDEwMCk7XG5cbiAgICAgICAgdmFyIGxvd2VyQm91bmQgPSBNYXRoLm1heCgwLjUgKiBtZWFuLCAwKTtcblxuICAgICAgICByZXR1cm4gW2xvd2VyQm91bmQsIG1lYW4sIHVwcGVyQm91bmRdO1xuXG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIFByZXBhcmVzIGRhdGEgZm9yIENoYW5jZSBvZiByYWluIGNoYXJ0XG4gICAgICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAgICAgKi9cbiAgICAgIHNldENoYW5jZU9mUmFpbiA9ICgpID0+IHtcbiAgICAgICAgaWYgKHZtLmRheXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHZtLmNoYW5jZU9mUmFpbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodm0ucHJlc3N1cmVBbW91bnQgPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gdm0uY2hhbmNlT2ZSYWluO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2bS50ZW1wZXJhdHVyZUFtb3VudCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiB2bS5jaGFuY2VPZlJhaW47XG4gICAgICAgIH1cblxuICAgICAgICB2bS5kYXlzLm1hcCgoYW1vdW50LCBkYXlObykgPT4ge1xuXG4gICAgICAgICAgY2hhbmNlT2ZSYWluKHZtLnByZXNzdXJlQW1vdW50LCB2bS50ZW1wZXJhdHVyZUFtb3VudCwgYW1vdW50KVxuICAgICAgICAgICAgLm1hcCgoY2hhbmNlLCBjaGFuY2VObykgPT4ge1xuXG4gICAgICAgICAgICAgIHZtLmNoYW5jZU9mUmFpbltjaGFuY2VOb10gPSB2bS5jaGFuY2VPZlJhaW5bY2hhbmNlTm9dIHx8IFtdO1xuICAgICAgICAgICAgICB2bS5jaGFuY2VPZlJhaW5bY2hhbmNlTm9dW2RheU5vXSA9IGNoYW5jZTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJGxvZy5kZWJ1ZygnY2hhbmNlT2ZSYWluJywgdm0uY2hhbmNlT2ZSYWluKTtcblxuICAgICAgICAkdGltZW91dCgoKSA9PiAkc2NvcGUuJGRpZ2VzdCgpKTtcblxuICAgICAgICByZXR1cm4gdm0uY2hhbmNlT2ZSYWluO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBQcmVwYXJlcyBkYXRhIEFtb3VudCBvZiByYWluZmFsbCBjaGFydFxuICAgICAgICogSXQncyBnZXR0aW5nIGNhbGxlZCBhZnRlciBBUEkgZmV0Y2guXG4gICAgICAgKiBAcGFyYW0gcmVzcG9uc2VcbiAgICAgICAqL1xuICAgICAgdXBkYXRlV2VhdGhlciA9IChyZXNwb25zZSkgPT4ge1xuICAgICAgICB2bS5kYXlzID0gcmVzcG9uc2UuZGF0YVswXS5kYXlzLm1hcCgoZGFpbHlJbmZvKSA9PiB7XG4gICAgICAgICAgdm0ubGFiZWxzLnB1c2goZGFpbHlJbmZvLmRheSk7XG4gICAgICAgICAgcmV0dXJuIGRhaWx5SW5mby5hbW91bnQ7XG4gICAgICAgIH0pO1xuICAgICAgICBzZXRDaGFuY2VPZlJhaW4oKTtcbiAgICAgICAgJGxvZy5kZWJ1ZygnZGF5cycsIHZtLmRheXMpO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBIYW5kbGVzIGVycm9ycyBvbiBBUEkgZmV0Y2hpbmdcbiAgICAgICAqIEBwYXJhbSBlcnJvclxuICAgICAgICovXG4gICAgICBmYWlsZWRUb1VwZGF0ZVdlYXRoZXIgPSAoZXJyb3IpID0+IHtcbiAgICAgICAgJGxvZy5lcnJvcihlcnJvcik7XG4gICAgICAgIHZtLmVycm9yID0gdm0uc3RyLmFwaUVycm9yO1xuICAgICAgfTtcblxuICAgIE9iamVjdC5hc3NpZ24oJHNjb3BlLCB7XG4gICAgICBwcmVzc3VyZUFtb3VudCA6IDAsXG4gICAgICB0ZW1wZXJhdHVyZUFtb3VudCA6IDBcbiAgICB9KTtcblxuICAgIE9iamVjdC5hc3NpZ24odm0sIHtcbiAgICAgIC8vIGxvY2FsZSBzdHJpbmdzXG4gICAgICBzdHIgOiB7XG4gICAgICAgIHRpdGxlIDogJ1dlYXRoZXIgRGFzYm9hcmQnLFxuICAgICAgICBhcGlFcnJvciA6ICdDb3VsZCBub3QgZmV0Y2ggdGhlIHdlYXRoZXIgZGF0YScsXG4gICAgICAgIHNsaWRlclByZXNzdXJlIDogJ1ByZXNzdXJlJyxcbiAgICAgICAgc2xpZGVyVGVtcGVyYXR1cmUgOiAnVGVtcGVyYXR1cmUnXG4gICAgICB9LFxuXG4gICAgICBlcnJvciA6ICcnLFxuXG4gICAgICBsYWJlbHMgOiBbXSxcblxuICAgICAgZGF5cyA6IFtdLFxuXG4gICAgICBjaGFuY2VPZlJhaW4gOiBbXSxcblxuICAgICAgLyoqXG4gICAgICAgKiBUcmlnZ2VycyBjaGFuY2Ugb2YgY2FsY3VsYXRpb24gd2hlbiBwcmVzc3VyZSBtZWFzdXJlIGlzIGNoYW5nZWRcbiAgICAgICAqIEBwYXJhbSBwcmVzc3VyZVZhbHVlXG4gICAgICAgKi9cbiAgICAgIG9uUHJlc3N1cmVDaGFuZ2UgOiAocHJlc3N1cmVWYWx1ZSkgPT4ge1xuICAgICAgICAkbG9nLmRlYnVnKCdvblByZXNzdXJlQ2hhbmdlJywgcHJlc3N1cmVWYWx1ZSk7XG4gICAgICAgIHZtLnByZXNzdXJlQW1vdW50ID0gcHJlc3N1cmVWYWx1ZTtcbiAgICAgICAgc2V0Q2hhbmNlT2ZSYWluKCk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIFRyaWdnZXJzIGNoYW5jZSBvZiBjYWxjdWxhdGlvbiB3aGVuIHRlbXBlcmF0dXJlIG1lYXN1cmUgaXMgY2hhbmdlZFxuICAgICAgICogQHBhcmFtIHRlbXBlcmF0dXJlVmFsdWVcbiAgICAgICAqL1xuICAgICAgb25UZW1wZXJhdHVyZUNoYW5nZSA6ICh0ZW1wZXJhdHVyZVZhbHVlKSA9PiB7XG4gICAgICAgICRsb2cuZGVidWcoJ29uVGVtcGVyYXR1cmVDaGFuZ2UnLCB0ZW1wZXJhdHVyZVZhbHVlKTtcbiAgICAgICAgdm0udGVtcGVyYXR1cmVBbW91bnQgPSB0ZW1wZXJhdHVyZVZhbHVlO1xuICAgICAgICBzZXRDaGFuY2VPZlJhaW4oKTtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogSW5pdGlhbGl6ZXMgbWVhc3VyZSB3YXRjaGVycyBhbmQgZmV0Y2hlcyB3ZWF0aGVyIEFQSVxuICAgICAgICovXG4gICAgICBpbml0aWFsaXplIDogKCkgPT4ge1xuICAgICAgICAkc2NvcGUuJHdhdGNoKHZtLmRheXMsIChuZXdWYWwpID0+IHNldENoYW5jZU9mUmFpbigpKTtcbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndGVtcGVyYXR1cmVBbW91bnQnLCB2bS5vblRlbXBlcmF0dXJlQ2hhbmdlKTtcbiAgICAgICAgJHNjb3BlLiR3YXRjaCgncHJlc3N1cmVBbW91bnQnLCB2bS5vblByZXNzdXJlQ2hhbmdlKTtcblxuICAgICAgICB3ZWF0aGVyQXBpXG4gICAgICAgICAgLmdldCgpXG4gICAgICAgICAgLnRoZW4odXBkYXRlV2VhdGhlcilcbiAgICAgICAgICAuY2F0Y2goZmFpbGVkVG9VcGRhdGVXZWF0aGVyKTtcblxuICAgICAgfVxuXG4gICAgfSk7XG5cbiAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
